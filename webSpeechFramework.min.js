function WebSpeechFramework(a,b){this.commands=[];this.config={};if(typeof a.lang==="undefined"||a.lang===null){a.lang="en_UK"}if(typeof a.variance==="undefined"||a.variance===null||!is_int(a.variance)){a.variance=5}if(typeof a.displayConsoleLog==="undefined"||a.displayConsoleLog===null||a.displayConsoleLog!==true){a.displayConsoleLog=false}if(typeof a.displayErrorMessages==="undefined"||a.displayErrorMessages===null||a.displayErrorMessages!==false){a.displayErrorMessages=true}if(typeof a.displayNoSupportMessage==="undefined"||a.displayNoSupportMessage===null||a.displayNoSupportMessage!==false){a.displayNoSupportMessage=true}if(typeof a.displayAllowMessage==="undefined"||a.displayAllowMessage===null||a.displayAllowMessage!==false){a.displayAllowMessage=true}if(typeof a.addDefaultErrorStyling==="undefined"||a.addDefaultErrorStyling===null||a.addDefaultErrorStyling!==false){a.addDefaultErrorStyling=true}if(typeof b==="object"){this.addCommands(b)}this.config=a;this.isRecording=false;this.errorMsgList={"no-speech":"Speech Recognition Error: No speech has been detected.","audio-capture":"Speech Recognition Error: Audio capture has failed. Maybe no microphone has been found?","not-allowed":"Speech Recognition Error: You need to have a connected microphone and grant the browser permission to use it.","no-support":"Speech Recognition Error: It seems like your browser has no support for Speech Recognition.",network:"Speech Recognition Error: There seems to be a problem with the network communication.",aborted:"Speech Recognition Error: It seems like speech input was aborted!","language-not-supported":"Speech Recognition Error: The specified language is not supported!"}}WebSpeechFramework.prototype.addCommands=function(b){if(typeof b!=="object"){return false}for(var a in b){if(!window[b[a].call]){temp={}}else{temp={};temp.command=webSpeechSaveString(b[a].command);temp.call=window[b[a].call];this.commands[a]=temp}}return true};WebSpeechFramework.prototype.callFunction=function(c){var b=this.commands;var d=null;for(var a in b){if(b[a].command===c){d=a}}if(d!==null){this.commands[d]["call"]();return true}else{return false}};WebSpeechFramework.prototype.checkInput=function(a){var i=this.commands;var b=getVarianceValue(a,this.config.variance);var c=null;var d=999999;for(var h in i){var f=webSpeechSaveString(a);var e=webSpeechSaveString(i[h].command);var g=levenshtein(f,e);if(g<=b&&(g<d)){c=h;d=g}}if(c!==null){return i[c]}else{return false}};WebSpeechFramework.prototype.start=function(){if(this.config.displayConsoleLog){console.log("Speech Recognition initialised")}var a=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.oSpeechRecognition||window.msSpeechRecognition;if(!a){if(this.config.displayNoSupportMessage){this.displayMessage("Speech Recognition Error: It seems like your browser has no support for Speech Recognition.")}return false}var b=new a;b.parent=this;b.lang=this.config.lang;b.continuous=true;b.interimResults=true;if(this.config.displayAllowMessage){this.displayMessage("Please allow microphone access!")}b.onstart=function(){if(typeof this.parent.config.onstart!=="undefined"||this.parent.config.onstart!==null){if(window[this.parent.config.onstart]){this.parent.config[onstart](event)}}this.parent.isRecording=true;this.parent.hideMessage()};b.onresult=function(d){if(typeof this.parent.config.onresult!=="undefined"||this.parent.config.onresult!==null){if(window[this.parent.config.onresult]){this.parent.config[onresult](d)}}var f="";for(var c=d.resultIndex;c<d.results.length;c++){f+=d.results[c][0].transcript}f=f.trim().toLowerCase();if(this.parent.config.displayConsoleLog){console.log("Result received: '"+f+"'")}var e=this.parent.checkInput(f);if(e){this.parent.callFunction(e.command)}};b.onerror=function(f){if(typeof this.parent.config.onerror!=="undefined"||this.parent.config.onerror!==null){if(window[this.parent.config.onerror]){this.parent.config[onerror](f)}}var d=f.error;var e="Sorry, a problem with the speech recognition has occured. Error-Code: "+d;var c=this.parent.errorMsgList;if(c[d]){e=c[d]}if(this.parent.config.displayConsoleLog){console.error(e)}if(this.parent.config.displayErrorMessages){this.parent.displayMessage(e)}};b.onend=function(){if(typeof this.parent.config.onend!=="undefined"||this.parent.config.onend!==null){if(window[this.parent.config.onend]){this.parent.config[onend](event)}}if(this.parent.config.displayConsoleLog){console.log("Speech Recognition stopped")}this.isRecording=false};b.start();this.rec=b;return true};WebSpeechFramework.prototype.stop=function(){this.rec.stop();return true};WebSpeechFramework.prototype.displayMessage=function(a){var b;if(b=document.getElementById("webspeech_message")){b.innerHTML=a}else{b=document.createElement("div");b.setAttribute("id","webspeech_message_container");innerDiv=document.createElement("div");innerDiv.setAttribute("id","webspeech_message");txt=document.createTextNode(a);innerDiv.appendChild(txt);closebtn=document.createElement("div");closebtn.setAttribute("id","webspeech_message_closebutton");closebtn.setAttribute("style","position: absolute; right: 10px; top: 0;");txt2=document.createTextNode("");closebtn.appendChild(txt2);b.appendChild(innerDiv);b.appendChild(closebtn);if(this.config.addDefaultErrorStyling){b.setAttribute("style","position: fixed; border: 2px dotted red; background: rgba(255,230,230,0.90); padding: 10px; left: 0; top: 0; right: 0; text-align: center; font-size: 25px; z-index: 9999; cursor: pointer;")}b.setAttribute("onclick","this.parentNode.removeChild(this);");if(this.config.addDefaultErrorStyling){b.setAttribute("onmouseover","this.style.background = 'rgb(255,180,180)'")}if(this.config.addDefaultErrorStyling){b.setAttribute("onmouseout","this.style.background = 'rgba(255,230,230,0.90)'")}document.body.appendChild(b)}};WebSpeechFramework.prototype.hideMessage=function(){if(div=document.getElementById("webspeech_message_container")){div.parentNode.removeChild(div)}};function levenshtein(p,o){if(p==o){return 0}var m=p.length;var k=o.length;if(m===0){return k}if(k===0){return m}var j=false;try{j=!("0")[0]}catch(h){j=true}if(j){p=p.split("");o=o.split("")}var q=new Array(m+1);var n=new Array(m+1);var a=0,s=0,f=0;for(a=0;a<m+1;a++){q[a]=a}var t="",r="";for(s=1;s<=k;s++){n[0]=s;r=o[s-1];for(a=0;a<m;a++){t=p[a];f=(t==r)?0:1;var d=q[a+1]+1;var l=n[a]+1;var i=q[a]+f;if(l<d){d=l}if(i<d){d=i}n[a+1]=d}var g=q;q=n;n=g}return q[m]}function getVarianceValue(d,b){var a=d.length;var c=0;if(b===0){return 0}c=b*0.3*Math.log(a);return Math.floor(c)}function webSpeechSaveString(a){a=a.trim().toLowerCase();a=a.replaceAll(". "," ").replaceAll("."," ");a=a.replaceAll("! "," ").replaceAll("!"," ");a=a.replaceAll("? "," ").replaceAll("?"," ");a=a.replaceAll(", "," ").replaceAll(","," ");a=a.replaceAll("; "," ").replaceAll(";"," ");a=a.replaceAll("ÃŸ","ss");a=a.replace(/ +(?= )/g,"");return a.trim()}String.prototype.replaceAll=function(b,a){if(!a){return this}return this.replace(new RegExp("["+b+"]","g"),a)};var th=["","thousand","million","billion","trillion"];var dg=["zero","one","two","three","four","five","six","seven","eight","nine"];var tn=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"];var tw=["twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function numbersToWords(d){d=d.toString();d=d.replace(/[\, ]/g,"");if(d!=parseFloat(d)){return"not a number"}var a=d.indexOf(".");if(a==-1){a=d.length}if(a>15){return"too big"}var g=d.split("");var e="";var b=0;for(var c=0;c<a;c++){if((a-c)%3==2){if(g[c]=="1"){e+=tn[Number(g[c+1])]+" ";c++;b=1}else{if(g[c]!=0){e+=tw[g[c]-2]+" ";b=1}}}else{if(g[c]!=0){e+=dg[g[c]]+" ";if((a-c)%3==0){e+="hundred "}b=1}}if((a-c)%3==1){if(b){e+=th[(a-c-1)/3]+" "}b=0}}if(a!=d.length){var f=d.length;e+="point ";for(var c=a+1;c<f;c++){e+=dg[g[c]]+" "}}return e.replace(/\s+/g," ")}function is_int(a){return a===+a&&isFinite(a)&&!(a%1)};